
# å®‰å…¨å¸½æ£€æµ‹ç³»ç»Ÿ - ç®¡ç†ç«¯APIæ¥å£æ–‡æ¡£

## æ¥å£åˆ†ç±»è¯´æ˜

### ğŸ”„ éœ€è¦æ›´æ–°çš„æ¥å£æ¨¡å—

ä»¥ä¸‹æ¨¡å—å¯¹åº”ç®¡ç†ç«¯é¡µé¢åŠŸèƒ½ï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚æ›´æ–°æ¥å£å®ç°ï¼š

- **ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰** - ç³»ç»Ÿæ¦‚è§ˆã€ç»Ÿè®¡åˆ†æã€æ´»åŠ¨æ—¥å¿—
- **è­¦å‘Šç®¡ç†ï¼ˆWarningsï¼‰** - è­¦å‘Šåˆ—è¡¨ã€çŠ¶æ€ç®¡ç†ã€å¤„ç†æµç¨‹
- **æ•°æ®å¯¼å‡ºï¼ˆExportï¼‰** - æ•°æ®å¯¼å‡ºã€æŠ¥å‘Šç”Ÿæˆ

### âœ… å¯ç›´æ¥ä½¿ç”¨çš„æ¨¡æ¿æ¥å£

ä»¥ä¸‹æ¨¡å—å¯ç›´æ¥æ²¿ç”¨ç°æœ‰æ¨¡æ¿æ¥å£ï¼Œæ— éœ€ä¿®æ”¹ï¼š

- **ç³»ç»Ÿè®¾ç½®ï¼ˆSettingsï¼‰** - æ£€æµ‹å‚æ•°é…ç½®ã€è­¦å‘Šè§„åˆ™è®¾ç½®
- **ç”¨æˆ·ç®¡ç†ï¼ˆUser Managementï¼‰** - ç”¨æˆ·å¢åˆ æ”¹æŸ¥ã€æƒé™ç®¡ç†

---

## ğŸ”„ éœ€è¦æ›´æ–°çš„æ¥å£æ¨¡å—

### 1. ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰

#### 1.1 è·å–ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ

**æ¥å£åœ°å€**: `GET /safehat/api/system-overview/`
**ä¸­æ–‡è¯´æ˜**: è·å–ç³»ç»Ÿæ•´ä½“è¿è¡ŒçŠ¶æ€æ¦‚è§ˆï¼ŒåŒ…æ‹¬æ‘„åƒå¤´ã€ç”¨æˆ·ã€è­¦å‘Šã€æ£€æµ‹ç­‰ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹**:

```json
{
 "code": 200,
 "msg": null,
 "data": {
  "cameras": {
   "total": 3,
   "online": 1,
   "offline": 2
  },
  "users": {
   "total": 12
  },
  "warnings": {
   "total": 19,
   "pending": 5,
   "today": 19
  },
  "detections": {
   "today": 50,
   "accuracy": 95.8
  },
  "system": {
   "availability": 33.33
  }
 }
}
```

#### 1.2 è·å–ç»Ÿè®¡åˆ†ææ•°æ®

**æ¥å£åœ°å€**: `GET /safehat/api/statistics/`
**ä¸­æ–‡è¯´æ˜**: è·å–ç³»ç»Ÿç»Ÿè®¡åˆ†ææ•°æ®ï¼ŒåŒ…æ‹¬æ£€æµ‹è¶‹åŠ¿ã€è­¦å‘Šè¶‹åŠ¿ã€æ‘„åƒå¤´æ´»åŠ¨ç­‰å›¾è¡¨æ•°æ®

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| type | string | å¦ | å›¾è¡¨ç±»å‹ï¼ˆdaily/weekly/monthlyï¼‰ï¼Œé»˜è®¤daily |
| days | int | å¦ | ç»Ÿè®¡å¤©æ•°ï¼Œé»˜è®¤7å¤© |

**å“åº”ç¤ºä¾‹**:

```json
{
 "code": 200,
 "msg": null,
 "data": {
  "detection_trend": [
   {
    "date": "2025-08-15",
    "count": 0
   },
  ],
  "warning_trend": [
   {
    "date": "2025-08-15",
    "count": 0
   },
  ],
  "warning_by_level": [
   {
    "warning_level": "medium",
    "count": 8
   },
  ],
  "camera_activity": [
   {
    "camera__name": "å®‰å…¨å¸½æ£€æµ‹æ‘„åƒå¤´9å·",
    "count": 8
   },
  ],
  "date_range": {
   "start": "2025-08-15",
   "end": "2025-08-22"
  }
 }
}
```

#### 1.3 è·å–æ£€æµ‹ç»Ÿè®¡æ•°æ®

**æ¥å£åœ°å€**: `GET /safehat/api/detection-stats/`
**ä¸­æ–‡è¯´æ˜**: è·å–æŒ‡å®šæ‘„åƒå¤´æˆ–å…¨éƒ¨æ‘„åƒå¤´çš„æ£€æµ‹ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬æ£€æµ‹æ€»æ•°ã€åˆè§„ç‡ç­‰

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| camera_id | string | å¦ | æ‘„åƒå¤´ID |
| date_range | int | å¦ | ç»Ÿè®¡å¤©æ•°ï¼Œé»˜è®¤7å¤© |

**å“åº”ç¤ºä¾‹**:

```json
{
 "code": 200,
 "msg": null,
 "data": {
  "stats": {
   "total_detections": 50,
   "person_count": 0,
   "wearing_hat_count": 0,
   "no_hat_count": 0,
   "avg_confidence": 0.746,
   "compliance_rate": 0
  }
 }
}
```

#### 1.4 è·å–æ´»åŠ¨æ—¥å¿—

**æ¥å£åœ°å€**: `GET /safehat/api/activity-logs/`
**ä¸­æ–‡è¯´æ˜**: è·å–ç³»ç»Ÿæ´»åŠ¨æ—¥å¿—è®°å½•ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ“ä½œã€ç³»ç»Ÿäº‹ä»¶ã€è­¦å‘Šå¤„ç†ç­‰æ—¥å¿—ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20 |
| type | string | å¦ | æ—¥å¿—ç±»å‹ï¼ˆuser/warning/systemï¼‰ |

**å“åº”ç¤ºä¾‹**:

```json

```

### 2. è­¦å‘Šç®¡ç†ï¼ˆWarningsï¼‰

#### 2.1 è·å–è­¦å‘Šåˆ—è¡¨

**æ¥å£åœ°å€**: `GET /safehat/api/warnings/`
**ä¸­æ–‡è¯´æ˜**: è·å–ç³»ç»Ÿä¸­çš„å®‰å…¨è­¦å‘Šåˆ—è¡¨ï¼Œæ”¯æŒæŒ‰çŠ¶æ€ã€æ‘„åƒå¤´ã€ä¸¥é‡ç¨‹åº¦ç­‰æ¡ä»¶è¿‡æ»¤

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |
| status | string | å¦ | çŠ¶æ€è¿‡æ»¤ï¼ˆpending/processing/resolved/ignoredï¼‰ |
| camera_id | string | å¦ | æ‘„åƒå¤´ID |
| severity | string | å¦ | ä¸¥é‡ç¨‹åº¦ï¼ˆinfo/warning/criticalï¼‰ |
| date_from | string | å¦ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| date_to | string | å¦ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |

**å“åº”ç¤ºä¾‹**:

```json
{
 "code": 200,
 "msg": null,
 "data": {
  "total": 19,
  "page": 1,
  "page_size": 10,
  "warnings": [
   {
    "id": "20",
    "title": "æœªä½©æˆ´å®‰å…¨å¸½è¿è§„",
    "description": "åœ¨æœºæ¢°åœæ”¾åŒºæ£€æµ‹åˆ°å®‰å…¨è¿è§„è¡Œä¸ºï¼Œéœ€è¦ç«‹å³å¤„ç†ã€‚",
    "warning_level": "high",
    "status": "resolved",
    "camera_name": "å®‰å…¨å¸½æ£€æµ‹æ‘„åƒå¤´8å·",
    "created_at": "2025-08-22T11:01:09.749800",
    "resolved_by": null,
    "resolved_at": null
   }
  ]
 }
}
```

#### 2.2 æ›´æ–°è­¦å‘ŠçŠ¶æ€

**æ¥å£åœ°å€**: `POST /safehat/api/warnings/update-status/`
**ä¸­æ–‡è¯´æ˜**: æ›´æ–°æŒ‡å®šè­¦å‘Šçš„å¤„ç†çŠ¶æ€ï¼Œå¦‚æ ‡è®°ä¸ºå·²è§£å†³ã€å¿½ç•¥ç­‰

**è¯·æ±‚å‚æ•°**:

```json
{
  "warning_id": "123",
  "status": "resolved",
  "notes": "å·²å¤„ç†å®Œæˆ"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "è­¦å‘ŠçŠ¶æ€æ›´æ–°æˆåŠŸ"
}
```

#### 2.3 åˆ é™¤è­¦å‘Š

**æ¥å£åœ°å€**: `DELETE /safehat/api/warnings/<warning_id>/`
**ä¸­æ–‡è¯´æ˜**: åˆ é™¤æŒ‡å®šçš„å®‰å…¨è­¦å‘Šè®°å½•

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| warning_id | string | æ˜¯ | è­¦å‘ŠID |

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "è­¦å‘Šåˆ é™¤æˆåŠŸ"
}
```

#### 2.4 æ‰‹åŠ¨åˆ›å»ºè­¦å‘Š

**æ¥å£åœ°å€**: `POST /safehat/api/warnings/create/`
**ä¸­æ–‡è¯´æ˜**: æ‰‹åŠ¨åˆ›å»ºå®‰å…¨è­¦å‘Šè®°å½•

**è¯·æ±‚å‚æ•°**:

```json
{
  "camera_id": "cam001",
  "warning_level": "high",
  "title": "å®‰å…¨å¸½è¿è§„",
  "description": "æ£€æµ‹åˆ°æœªä½©æˆ´å®‰å…¨å¸½",
  "assigned_to": "username"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "è­¦å‘Šåˆ›å»ºæˆåŠŸ",
  "data": {
    "warning_id": "456",
    "created_at": "2024-01-15T10:30:00Z"
  }
}
```

### 3. æ•°æ®å¯¼å‡ºï¼ˆExportï¼‰

#### 3.1 å¯¼å‡ºæ•°æ®

**æ¥å£åœ°å€**: `POST /safehat/api/data-export/`
**ä¸­æ–‡è¯´æ˜**: å¯¼å‡ºæŒ‡å®šç±»å‹å’Œæ—¶é—´èŒƒå›´çš„æ•°æ®ï¼Œæ”¯æŒç”¨æˆ·ã€è­¦å‘Šã€æ£€æµ‹è®°å½•ç­‰æ•°æ®å¯¼å‡º

**è¯·æ±‚å‚æ•°**:

```json
{
  "type": "warnings",
  "start_date": "2024-01-01",
  "end_date": "2024-01-31"
}
```

**æ”¯æŒçš„å¯¼å‡ºç±»å‹**:

- `users`: ç”¨æˆ·æ•°æ®
- `warnings`: è­¦å‘Šæ•°æ®
- `detections`: æ£€æµ‹è®°å½•

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "export_data": [
      {
        "id": "123",
        "camera_id": "CAM001",
        "warning_level": "warning",
        "status": "resolved",
        "title": "æœªä½©æˆ´å®‰å…¨å¸½è­¦å‘Š",
        "description": "æ£€æµ‹åˆ°äººå‘˜æœªä½©æˆ´å®‰å…¨å¸½",
        "created_at": "2024-01-15 10:30:00"
      }
    ],
    "total_count": 1,
    "export_type": "warnings"
  }
}
```

---

## âœ… å¯ç›´æ¥ä½¿ç”¨çš„æ¨¡æ¿æ¥å£

### 4. æ‘„åƒå¤´ç®¡ç†ï¼ˆCamera Managementï¼‰

#### 4.1 è·å–æ‘„åƒå¤´åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /safehat/api/cameras/`
**ä¸­æ–‡è¯´æ˜**: è·å–ç³»ç»Ÿä¸­æ‰€æœ‰æ‘„åƒå¤´çš„åˆ—è¡¨ä¿¡æ¯ï¼Œæ”¯æŒåˆ†é¡µæŸ¥è¯¢å’ŒçŠ¶æ€è¿‡æ»¤

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| query | string | å¦ | æœç´¢å…³é”®è¯ï¼ˆæ‘„åƒå¤´åç§°æˆ–IDï¼‰ |
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |
| status | string | å¦ | çŠ¶æ€è¿‡æ»¤ï¼ˆonline/offlineï¼‰ |

**å“åº”ç¤ºä¾‹**:

```json
{
 "code": 200,
 "msg": null,
 "data": {
  "total": 3,
  "page": 1,
  "page_size": 10,
  "cameras": [
   {
    "camera_id": "SH009",
    "name": "å®‰å…¨å¸½æ£€æµ‹æ‘„åƒå¤´9å·",
    "location": "å±é™©å“å­˜æ”¾åŒº",
    "is_online": false,
    "ip_address": "192.168.2.108",
    "port": 1935,
    "rtsp_url": "rtsp://192.168.2.108:554/stream",
    "is_active": true,
    "last_heartbeat": "2025-08-22T10:49:05.960019",
    "created_at": "2025-08-22T10:57:05.960019"
   },
  ]
 }
}
```

### 5. ç³»ç»Ÿè®¾ç½®ï¼ˆSettingsï¼‰

**è¯´æ˜**: ç³»ç»Ÿè®¾ç½®åŠŸèƒ½å¯ç›´æ¥ä½¿ç”¨ç°æœ‰æ¨¡æ¿æ¥å£ï¼ŒåŒ…æ‹¬ï¼š

- æ£€æµ‹å‚æ•°é…ç½®
- è­¦å‘Šè§„åˆ™è®¾ç½®
- ç³»ç»Ÿå‚æ•°ç®¡ç†

### 6. ç”¨æˆ·ç®¡ç†ï¼ˆUser Managementï¼‰

**è¯´æ˜**: ç”¨æˆ·ç®¡ç†åŠŸèƒ½å¯ç›´æ¥ä½¿ç”¨ç°æœ‰æ¨¡æ¿æ¥å£ï¼ŒåŒ…æ‹¬ï¼š

- ç”¨æˆ·å¢åˆ æ”¹æŸ¥
- è§’è‰²æƒé™ç®¡ç†
- ç”¨æˆ·çŠ¶æ€ç®¡ç†

---

## æ¥å£å¼€å‘ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆéœ€è¦ç«‹å³å¼€å‘ï¼‰

1. **ä»ªè¡¨ç›˜æ¥å£** - ç³»ç»Ÿæ¦‚è§ˆã€ç»Ÿè®¡åˆ†æ
2. **è­¦å‘Šç®¡ç†æ¥å£** - è­¦å‘Šåˆ—è¡¨ã€çŠ¶æ€ç®¡ç†

### ä¸­ä¼˜å…ˆçº§ï¼ˆåç»­å¼€å‘ï¼‰

3. **æ•°æ®å¯¼å‡ºæ¥å£** - æ•°æ®å¯¼å‡ºåŠŸèƒ½
4. **æ´»åŠ¨æ—¥å¿—æ¥å£** - æ—¥å¿—è®°å½•æŸ¥è¯¢

### ä½ä¼˜å…ˆçº§ï¼ˆå¯å»¶åï¼‰

5. **æ‘„åƒå¤´ç®¡ç†æ¥å£ä¼˜åŒ–** - æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´
6. **ç³»ç»Ÿè®¾ç½®æ¥å£å®šåˆ¶** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶åŒ–
